FROM registry.scontain.com:5050/sconecuratedimages/crosscompilers

COPY . /sqlite-ndp
COPY openssl-src/ /openssl-src

RUN apk update
RUN apk add make
RUN apk add perl
RUN apk add vim

WORKDIR /openssl-src
RUN ./config
RUN make clean
RUN make || true
RUN make install

WORKDIR /sqlite-ndp/merkle-tree/src
RUN make

WORKDIR /sqlite-ndp/host/secure
RUN make clean || true
RUN OPENSSL_SRC=/openssl-src make

#WORKDIR /sqlite-ndp/benchmark/macrobenchmark
WORKDIR /sqlite-ndp/host/secure

# docker build -f benchmark/scone-stuff/sec-ndp -t host-ndp .

# docker run $MOUNT_SGXDEVICE host-ndp /bin/bash -c "SCONE_VERSION=1 SCONE_HEAP=2G ./host-ndp -D .. -Q \"select * from TABLE1;\" -S \"select count(*) from lineitem;\" 172.17.0.1"
